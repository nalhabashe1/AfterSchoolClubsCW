<html>
  <head>
    <title>After School Clubs</title>
    <script src="https://unpkg.com/vue"></script>
    <script src="lessons.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css"/>
    <link href="tailwind.css" rel="stylesheet">
  </head>

  <body>
    <div id="app">
      <header  class="p-4 flex w-full bg-blue-900 text-white font-semibold justify-between ">
        <h1 v-text="sitename"></h1> 
        <button v-on:click="showCheckout" class="bg-green-700 w-40 font-semibold h-10 p-2 rounded-lg" v-if="cartItemCount > 0 && showCheckout">
          {{cartItemCount}}
          <span class="fas fa-cart-plus"></span>
          View Cart
        </button>
        <button class="bg-gray-200 text-gray-600 w-40 font-semibold h-10 p-2 rounded-lg" v-on:click="showBackLesson" v-else> <span class="fas fa-cart-plus"></span> Cart</button>
      </header>
    
      <main>    
        <div v-if="showLesson">
          <div class="container mx-auto p-5 bg-indigo-200 h-40 flex w-full">
            <!-- <label>Search: </label> -->
          <input class="flex-grow px-4 rounded-l-full rounded-r-full text-sm  focus:outline" type="search" v-model="search" placeholder="Search"/>
          <input id="sortLocation" name="filter" type="radio" v-on:Click="sortLocation"> <label for="sortLocation">Location</label>
          <input id="sortAvailability" name="filter" type="radio" v-on:Click="sortAvailability"> <label for="sortAvailability">Availability</label>
          <input id="sortLowestPrice" name="filter" type="radio" v-on:Click="sortLowestPrice"/> <label for="sortLowestPrice">Low Price</label>
          <input id="sortHighestPrice" name="filter" type="radio" v-on:Click="sortHighestPrice"/> <label for="sortHighestPrice">High Price</label>
          <input id="ascending" name="filter" type="radio" v-on:Click="ascending"> <label for="ascending">Ascending</label>
          <input id="descending" name="filter" type="radio" v-on:Click="descending"> <label for="descending">Descending</label>
        </div>
          <div class="grid grid-flow-row grid-cols-4 gap-6" >
          <div v-for="lesson in getfilteredSearch" class="group relative">           
            <div class=" shadow-xl border-1 border-gray-300 w-70 rounded-md m-2 font-semibold">
              <img class="w-50 h-50 object-center bg-gray-200 hover:bg-gray-100 " v-bind:src="lesson.image" />
            <h2 class="pl-2">Subject: {{lesson.subject}}</h2>
            <p class="pl-2">Location: {{lesson.location}}</p>
            <p class="pl-2">Price: {{lesson.price}}</p>
            <p class="pl-2">Spaces: {{lesson.spaces - cartCount(lesson)}}</p>
            <p>
              <span class="pl-2" v-for="n in lesson.rating">★</span>
              <!-- <span v-for="n in 5-lesson.rating">☆</span> -->
            </p>
            <button class="bg-green-700 text-white rounded-b-md font-semibold p-3 bg-opacity-75 w-full text-center" v-on:click="addToCart(lesson)" v-if="canAddToCart(lesson)">
              Add to Cart
            </button>
            <button class="bg-gray-200 text-gray-600  rounded-b-md font-semibold p-3 bg-opacity-75 w-full text-center" disabled="disabled" v-else>Add to Cart</button>
            <!-- <span v-if="lesson.spaces - cartCount(lesson) == 0">
              All out!</span
            >  -->
            <!-- <span v-else-if="lesson.spaces - cartCount(lesson) < 5">
              Only {{lesson.spaces - cartCount(lesson)}} left!
            </span>
            <span v-else>Buy Now!</span> -->
            <!-- </div> -->
           
          </div>
          </div>
        </div>
        </div>
   
       <div v-else>
          <h2>Checkout</h2>
          <div class="grid grid-flow-row grid-cols-4 gap-6" >
          <div v-for="(lesson, index) in cart" :key="lesson.id" class="group relative">           
            <figure>
              <img v-bind:src="lesson.image" />
            </figure>
            <h2 v-text="lesson.subject"></h2>
            <p v-html="lesson.location"></p>
            <button class="bg-blue-500 rounded-xl p-2" v-on:click="removeFromCart(index, lesson)">
             Remove
            </button>
          </div>
        </div>
      </main>
    </div>

    <script type="text/javascript">
      var webstore = new Vue({
        el: "#app",
        data: {
          sitename: "Hamilton - After School Clubs",
          lessons: lessons,
          cart: [],
          search: '',
          showLesson: true,
          showCart: true
        },
        methods: {
          addToCart(lesson) {
            this.cart.push(lesson);
            lesson.spaces--;
          },
          removeFromCart(index, lesson){
            this.cart.splice(index, 1);
            lesson.spaces++;
          },
          showCheckout() {
            this.showLesson = this.showLesson ? false : true;
          },
          showBackLesson() {
            this.showLesson = false;
          },
          submitForm() {
            alert("Order Submitted");
          },
          canAddToCart(lesson) {
            return lesson.spaces > this.cartCount(lesson);
          },
          // cartCount -- it will check the id if its valid it will increment runs each time 
          cartCount(lesson){
            let count =0;
            for(let i =0; i < this.cart.length; i++){
              if(this.cart[i] === lesson ){
                // count++
              }
            }
            return count;
          },
          sortLowestPrice(){
            this.lessons.sort((a, b) => a.price > b.price ? 1 : -1);
          },
          sortHighestPrice(){
            this.lessons.sort((a, b) => a.price < b.price ? 1 : -1);
          },
          ascending(){
          this.lessons.sort((a, b) => (a.subject > b.subject) ? 1 : -1);
          },
          descending(){
          this.lessons.sort((a, b) => (a.subject < b.subject) ? 1 : -1);
          },
          sortLocation(){
          this.lessons.sort((a, b) => (a.location > b.location) ? 1 : -1);
          },
          sortAvailability(){
          this.lessons.sort((a, b) => (a.spaces < b.spaces) ? 1 : -1);
          },
          sortHighRating(){
          this.lessons.sort((a, b) => (a.rating < b.rating) ? 1 : -1);
          },
          // descending(){
          // this.lessons.sort((a, b) => (a.subject < b.subject) ? 1 : -1);
          // }
        },
        computed: {
          cartItemCount() {
            return this.cart.length;
          },
          getfilteredSearch() {
          const searchInput = this.search.toLowerCase();
          const isMatched = str => str.toLowerCase().includes(searchInput);
          return this.lessons.filter(lesson => isMatched(lesson.subject) || isMatched(lesson.location));
          }
        }
      });
    </script>
  </body>
</html>
